import{e as n,o as r,B as q,a as e,d,p as K,D as Q,z as j,q as X,C as Z,j as ee,c as te,w as H,f as u,F as v,t as l,h as S,u as w,g as c,k as h,x as k,n as M,b as R,E as se}from"./app-DeQX2WPH.js";import{u as oe,_ as ae}from"./AppLayout-BkeXll_N.js";import{_ as P}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{l as le}from"./lodash-C7uqkgLR.js";import{d as V,u as re,t as ne}from"./es-D_LJtNiC.js";const ie={},de={xmlns:"http://www.w3.org/2000/svg",x:"0px",y:"0px",width:"48",height:"48",viewBox:"0 0 48 48"};function ce($,p){return r(),n("svg",de,p[0]||(p[0]=[q('<path fill="#fff" d="M4.868,43.303l2.694-9.835C5.9,30.59,5.026,27.324,5.027,23.979C5.032,13.514,13.548,5,24.014,5c5.079,0.002,9.845,1.979,13.43,5.566c3.584,3.588,5.558,8.356,5.556,13.428c-0.004,10.465-8.522,18.98-18.986,18.98c-0.001,0,0,0,0,0h-0.008c-3.177-0.001-6.3-0.798-9.073-2.311L4.868,43.303z"></path><path fill="#fff" d="M4.868,43.803c-0.132,0-0.26-0.052-0.355-0.148c-0.125-0.127-0.174-0.312-0.127-0.483l2.639-9.636c-1.636-2.906-2.499-6.206-2.497-9.556C4.532,13.238,13.273,4.5,24.014,4.5c5.21,0.002,10.105,2.031,13.784,5.713c3.679,3.683,5.704,8.577,5.702,13.781c-0.004,10.741-8.746,19.48-19.486,19.48c-3.189-0.001-6.344-0.788-9.144-2.277l-9.875,2.589C4.953,43.798,4.911,43.803,4.868,43.803z"></path><path fill="#cfd8dc" d="M24.014,5c5.079,0.002,9.845,1.979,13.43,5.566c3.584,3.588,5.558,8.356,5.556,13.428c-0.004,10.465-8.522,18.98-18.986,18.98h-0.008c-3.177-0.001-6.3-0.798-9.073-2.311L4.868,43.303l2.694-9.835C5.9,30.59,5.026,27.324,5.027,23.979C5.032,13.514,13.548,5,24.014,5 M24.014,42.974C24.014,42.974,24.014,42.974,24.014,42.974C24.014,42.974,24.014,42.974,24.014,42.974 M24.014,42.974C24.014,42.974,24.014,42.974,24.014,42.974C24.014,42.974,24.014,42.974,24.014,42.974 M24.014,4C24.014,4,24.014,4,24.014,4C12.998,4,4.032,12.962,4.027,23.979c-0.001,3.367,0.849,6.685,2.461,9.622l-2.585,9.439c-0.094,0.345,0.002,0.713,0.254,0.967c0.19,0.192,0.447,0.297,0.711,0.297c0.085,0,0.17-0.011,0.254-0.033l9.687-2.54c2.828,1.468,5.998,2.243,9.197,2.244c11.024,0,19.99-8.963,19.995-19.98c0.002-5.339-2.075-10.359-5.848-14.135C34.378,6.083,29.357,4.002,24.014,4L24.014,4z"></path><path fill="#40c351" d="M35.176,12.832c-2.98-2.982-6.941-4.625-11.157-4.626c-8.704,0-15.783,7.076-15.787,15.774c-0.001,2.981,0.833,5.883,2.413,8.396l0.376,0.597l-1.595,5.821l5.973-1.566l0.577,0.342c2.422,1.438,5.2,2.198,8.032,2.199h0.006c8.698,0,15.777-7.077,15.78-15.776C39.795,19.778,38.156,15.814,35.176,12.832z"></path><path fill="#fff" fill-rule="evenodd" d="M19.268,16.045c-0.355-0.79-0.729-0.806-1.068-0.82c-0.277-0.012-0.593-0.011-0.909-0.011c-0.316,0-0.83,0.119-1.265,0.594c-0.435,0.475-1.661,1.622-1.661,3.956c0,2.334,1.7,4.59,1.937,4.906c0.237,0.316,3.282,5.259,8.104,7.161c4.007,1.58,4.823,1.266,5.693,1.187c0.87-0.079,2.807-1.147,3.202-2.255c0.395-1.108,0.395-2.057,0.277-2.255c-0.119-0.198-0.435-0.316-0.909-0.554s-2.807-1.385-3.242-1.543c-0.435-0.158-0.751-0.237-1.068,0.238c-0.316,0.474-1.225,1.543-1.502,1.859c-0.277,0.317-0.554,0.357-1.028,0.119c-0.474-0.238-2.002-0.738-3.815-2.354c-1.41-1.257-2.362-2.81-2.639-3.285c-0.277-0.474-0.03-0.731,0.208-0.968c0.213-0.213,0.474-0.554,0.712-0.831c0.237-0.277,0.316-0.475,0.474-0.791c0.158-0.317,0.079-0.594-0.04-0.831C20.612,19.329,19.69,16.983,19.268,16.045z" clip-rule="evenodd"></path>',5)]))}const ue=P(ie,[["render",ce]]),pe={},xe={xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24"};function ge($,p){return r(),n("svg",xe,p[0]||(p[0]=[e("path",{fill:"currentColor",d:"M3 3v19l3-2l3 2l3-2v-7H7v-2h7.47L21 14.26V3zm14 6H7V7h10zm-3 14v-4l4-1l-4-1v-4l10 5z"},null,-1)]))}const me=P(pe,[["render",ge]]),fe={class:"font-semibold text-xl text-gray-800 leading-tight"},ve={class:"py-12"},he={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},_e={class:"mb-4 flex justify-center sm:justify-end gap-2"},ye=["disabled"],be={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},we={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg p-6"},ke={key:0,class:"animate-fade-in"},Ce={class:"text-2xl font-bold mb-6 text-gray-800 border-b pb-4"},ze={class:"space-y-3 mb-8"},Ee={class:"flex flex-col items-start w-full"},je={class:"font-semibold text-gray-700"},Se={class:"text-gray-500 font-light text-sm"},Me={class:"text-sm text-gray-500"},Ve={class:"text-green-700"},Ne={key:0,class:"text-yellow-600 text-xs text-center"},Ue={key:1,class:"text-red-700 text-xs text-center"},Be={class:"flex flex-col sm:flex-row items-center gap-4 mt-2 sm:mt-0"},Pe={class:"flex items-center gap-4"},$e={class:"flex items-center gap-2 text-sm"},Ae=["onUpdate:modelValue","max"],Fe={class:"flex items-center gap-2 text-sm"},Le=["onUpdate:modelValue"],Ie={class:"w-full sm:w-auto flex place-content-between gap-4"},He={class:"text-right font-medium text-gray-700"},Re=["onClick"],De={key:0,class:"text-center py-4 text-gray-500"},Je={class:"mt-8 border-t pt-6"},Oe={key:0,class:"border rounded-md mt-2 max-h-60 overflow-y-auto bg-white shadow-lg"},Te=["onClick"],Ye={class:"text-gray-500"},Ge={class:"mt-6 text-center sm:text-right border-t pt-4"},We={class:"text-2xl font-bold text-gray-800"},qe={class:"flex justify-center sm:justify-end gap-2 mt-4"},Ke=["disabled"],Qe={key:1},Xe={class:"flex flex-col xl:flex-row jusitfy-center items-stretch w-full xl:space-x-8 space-y-4 md:space-y-6 xl:space-y-0"},Ze={class:"flex flex-col justify-start items-start w-full space-y-4 md:space-y-6 xl:space-y-8"},et={class:"flex flex-col justify-start items-start w-full"},tt={class:"flex flex-col md:flex-row justify-start items-start md:items-center md:space-x-6 xl:space-x-8 w-full"},st={class:"md:flex-col flex-col flex justify-between items-start w-full space-y-4 md:space-y-6"},ot={class:"w-full flex flex-col justify-start items-start space-y-8"},at={class:"flex flex-col gap-2 w-full"},lt={class:"text-xl xl:text-2xl font-semibold text-center lg:text-left leading-6 text-gray-800"},rt=["href"],nt={class:"bg-emerald-500 text-white py-2 px-4 rounded-md w-full lg:w-60"},it={class:"flex flex-row items-center justify-center gap-2"},dt=["disabled"],ct={class:"flex flex-row items-center justify-center gap-2"},ut={key:0},pt={key:1},xt={key:0},gt={class:"flex justify-start items-start flex-col space-y-2"},mt={class:"text-sm leading-none text-gray-800"},ft={class:"text-sm leading-none text-gray-800"},vt=["disabled"],ht=["value"],_t={key:0,class:"text-md text-emerald-500"},yt={class:"flex justify-between items-end lg:items-end space-x-8 w-full"},bt={class:"text-base xl:text-lg leading-6"},wt={class:"text-base xl:text-lg leading-6 text-gray-800 border border-gray-800 rounded-full py-1 px-3"},kt={class:"grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 items-stretch"},Ct=["href"],zt={class:"flex justify-between items-start space-x-8 w-full gap-4 text-sm leading-none text-gray-800 pb-4"},Et={class:"text-sm leading-none text-gray-800"},jt={class:"text-sm leading-none text-gray-800"},St={class:"text-sm leading-none text-gray-800"},Mt={class:"space-y-2 w-full"},Vt={class:"text-md text-gray-500 text-center lg:text-left"},Nt={class:"mt-1 mb-6 flex flex-row gap-2 rounded-lg"},Ut={key:0,class:"text-emerald-500"},Bt={__name:"Show",setup($){V.extend(re),V.extend(ne),V.locale("es");const p=oe(),a=d(K().props.cotizacion),C=d(a.value.cliente.telefono),D=d(["pendiente","sin respuesta","revision","aprobada","rechazada"]),N=d(""),U=d(!1);Q(()=>a.value.estado,async(o,s)=>{U.value=!0;try{const t=await j.put(route("cotizaciones.actualizarEstado",a.value.id),{newEstado:o,oldEstado:s});N.value=t.data.resultadoEstado,console.log(t.resultadoEstado)}catch(t){console.error(t),a.value.estado=s,alert("Error al actualizar el estado")}finally{U.value=!1}});const B=d(null),J=async()=>{try{const o=await j.put(route("clientes.actualizarNumero",a.value.cliente.id),{telefono:C.value});B.value=o.data.resultado}catch(o){console.log(o)}},z=d("");X(async()=>{try{z.value=await p.msgWPF(a)}catch(o){console.error(o)}});const m=d(!1),E=d(""),O=async()=>{m.value=!0;try{const o=await j.post(route("cotizaciones.enviarCotizacion",a.value.id));E.value="Envío exitoso: "+o.data.estado+" | "+o.data.mensaje,console.log(o.data)}catch(o){E.value="Envío fallido: "+o.response.data.error,console.log(o)}finally{m.value=!1}},x=d(!1),T=()=>{i.detalles=JSON.parse(JSON.stringify(a.value.detalles)),x.value=!0},A=()=>{i.reset(),i.clearErrors(),x.value=!1},i=Z({detalles:[]}),F=ee(()=>i.detalles.reduce((o,s)=>o+s.precio_unitario*s.cantidad,0)),_=d(""),y=d([]),Y=async()=>{if(!_.value){y.value=[];return}try{const o=await j.get(route("productos.search",{search:_.value}));y.value=o.data.results}catch(o){console.error("Error buscando productos:",o)}},L=le.debounce(Y,300),G=o=>{const s=i.detalles.find(t=>t.producto_id===o.id);if(s){s.cantidad++;return}i.detalles.push({id:null,cotizacion_id:a.value.id,producto_id:o.id,cantidad:1,precio_unitario:o.precio_normal,subtotal:o.precio_normal,producto:o}),_.value="",y.value=[]},W=o=>{i.detalles=i.detalles.filter(s=>s.producto_id!==o)},f=d(!1),I=async()=>{if(!f.value){f.value=!0;try{console.log("Enviando",i.detalles);const o={total:Number(F.value),detalles:i.detalles.map(s=>({producto_id:Number(s.producto_id),cantidad:Number(s.cantidad),precio_unitario:Number(s.precio_unitario)}))};console.log("Payload final ->",o),await i.transform(()=>o).put(route("cotizaciones.update",a.value.id),{preserveState:!1,onStart:()=>console.log("Inertia: request iniciada"),onSuccess:s=>{console.log("Inertia success",s),a.value=JSON.parse(JSON.stringify(s.props.cotizacion)),x.value=!1,i.reset()},onError:s=>{console.error("Errores de validacion de Inertia:",s)},onFinish:()=>{f.value=!1}})}catch(o){console.error("submitUpdate error:",o),f.value=!1}}},g=o=>new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS"}).format(o);return(o,s)=>(r(),te(ae,{title:"Cotizacion #"+a.value.id},{header:H(()=>[e("h2",fe," Cotizacion #"+l(a.value.id),1)]),default:H(()=>[e("div",ve,[e("div",he,[e("div",_e,[x.value?u("",!0):(r(),n("button",{key:0,onClick:T,class:"bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 w-full sm:w-fit mx-4 sm:mx-0"}," Editar Cotización ")),x.value?(r(),n(v,{key:1},[e("button",{onClick:A,class:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105"}," Cancelar "),e("button",{onClick:I,disabled:f.value,class:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"}," Guardar Cambios ",8,ye)],64)):u("",!0)]),e("div",be,[e("div",null,[e("div",we,[x.value?(r(),n("div",ke,[e("h3",Ce,"Editando Cotización #"+l(a.value.id),1),e("div",ze,[(r(!0),n(v,null,S(w(i).detalles,t=>(r(),n("div",{key:t.producto_id,class:"flex items-center flex-col sm:flex-row justify-between p-2 bg-gray-50 rounded-lg border border-gray-200"},[e("div",Ee,[e("p",je,[c(l(t.producto.titulo)+" ",1),e("span",Se,l(t.producto.codigo),1)]),e("p",Me,[c(" Precio Unitario: "+l(g(t.precio_unitario))+" | ",1),e("span",Ve,l(t.producto.stock)+" und.",1)]),t.cantidad===t.producto.stock?(r(),n("p",Ne,"Stock máximo")):u("",!0),t.cantidad>t.producto.stock?(r(),n("p",Ue,"Stock excedido")):u("",!0)]),e("div",Be,[e("div",Pe,[e("label",$e,[s[5]||(s[5]=c(" Cantidad: ")),h(e("input",{type:"number","onUpdate:modelValue":b=>t.cantidad=b,min:"1",max:t.producto.stock,class:"w-20 text-center border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,8,Ae),[[k,t.cantidad]])]),e("label",Fe,[s[6]||(s[6]=c(" Precio: ")),h(e("input",{type:"number","onUpdate:modelValue":b=>t.precio_unitario=b,readonly:"",min:"1",class:"w-28 text-center border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,8,Le),[[k,t.precio_unitario]])])]),e("div",Ie,[e("p",He,"Subtotal: "+l(g((t.precio_unitario*t.cantidad).toFixed(2))),1),e("button",{onClick:b=>W(t.producto_id),class:"text-red-500 hover:text-red-700 transition-transform transform hover:scale-110"},s[7]||(s[7]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)]),8,Re)])])]))),128)),w(i).detalles.length===0?(r(),n("div",De," La cotización no tiene productos. ¡Agrega uno! ")):u("",!0)]),e("div",Je,[s[8]||(s[8]=e("h4",{class:"text-lg font-semibold mb-2 text-gray-700"},"Agregar Producto",-1)),h(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=t=>_.value=t),onKeyup:s[1]||(s[1]=(...t)=>w(L)&&w(L)(...t)),placeholder:"Buscar por código, título...",class:"w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"},null,544),[[k,_.value]]),y.value.length?(r(),n("ul",Oe,[(r(!0),n(v,null,S(y.value,t=>(r(),n("li",{key:t.id,onClick:b=>G(t),class:M(["p-3 hover:bg-indigo-50 cursor-pointer border-b last:border-b-0",{"opacity-50 cursor-not-allowed":t.stock<=0}])},[c(l(t.titulo)+" - ",1),e("span",Ye,"("+l(t.codigo)+") - "+l(g(t.precio_normal)),1),e("span",{class:M(["text-white px-1 rounded-sm ml-2",t.stock>0?"bg-green-700":"bg-red-700"])},l(t.stock)+" und.",3)],10,Te))),128))])):u("",!0)]),e("div",Ge,[e("p",We,"Total: "+l(g(F.value.toFixed(2))),1),e("div",qe,[x.value?(r(),n(v,{key:0},[e("button",{onClick:A,class:"bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105"}," Cancelar "),e("button",{onClick:I,disabled:f.value,class:"bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-transform transform hover:scale-105 disabled:opacity-50 disabled:cursor-not-allowed"}," Guardar Cambios ",8,Ke)],64)):u("",!0)])])])):(r(),n("div",Qe,[e("div",Xe,[e("div",Ze,[e("div",et,[e("div",tt,[e("div",st,[e("div",ot,[e("div",at,[e("h3",lt,"Nro #"+l(a.value.id)+" | "+l(w(V)(a.value.created_at).tz("America/Argentina/Buenos_Aires").format("D [de] MMMM [de] YYYY, HH:mm:ss")),1),e("a",{href:`https://api.whatsapp.com/send?phone=549${C.value}&text=${encodeURIComponent(z.value)}`,target:"_blank"},[e("button",nt,[e("div",it,[s[9]||(s[9]=c(" Enviar cotizacion ")),R(ue,{class:"w-8 h-8"})])])],8,rt),e("button",{onClick:O,disabled:m.value,class:M(["py-2 px-4 rounded-md w-full lg:w-60",{"bg-blue-600 text-white":m.value,"bg-gray-900 text-white":!m.value}])},[e("div",ct,[m.value?(r(),n("span",pt,"Enviando...")):(r(),n("span",ut,"Enviar a 3C")),R(me,{class:"w-8 h-8"})])],10,dt),E.value?(r(),n("p",xt,l(E.value),1)):u("",!0)]),e("div",gt,[e("p",mt,[s[10]||(s[10]=e("span",{class:"dark:text-gray-400 text-gray-300"},"Responsable: ",-1)),c(" "+l(a.value.user.name),1)]),e("p",ft,[s[11]||(s[11]=e("span",{class:"dark:text-gray-400 text-gray-300"},"Cliente: ",-1)),c(" "+l(a.value.cliente.nombre),1)]),h(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>a.value.estado=t),class:M(["capitalize rounded-md",{"bg-green-200":a.value.estado==="aprobada","bg-red-200":a.value.estado==="rechazada","bg-gray-300":a.value.estado==="sin respuesta","bg-blue-200":a.value.estado==="pendiente","bg-yellow-200":a.value.estado==="revision"}]),disabled:U.value},[(r(!0),n(v,null,S(D.value,t=>(r(),n("option",{key:t,value:t,class:"capitalize"},l(t),9,ht))),128))],10,vt),[[se,a.value.estado]]),N.value?(r(),n("p",_t,l(N.value),1)):u("",!0)])]),e("div",yt,[e("p",bt,l(g(a.value.total)),1),e("p",wt,l(a.value.detalles.length)+" items",1)]),e("div",kt,[(r(!0),n(v,null,S(a.value.detalles,t=>(r(),n("div",{key:t.id,class:"flex flex-col bg-gray-100 shadow-md border border-gray-200 p-4 rounded-lg justify-between items-start lg:items-start space-y-1 w-full"},[e("a",{href:t.producto.link_producto,target:"_blank",class:"w-full"},[e("p",zt,[c(l(t.producto.titulo)+" ",1),s[12]||(s[12]=e("span",null,[e("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"},[e("path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"}),e("polyline",{points:"15 3 21 3 21 9"}),e("line",{x1:"10",y1:"14",x2:"21",y2:"3"})])],-1))])],8,Ct),e("p",Et,[s[13]||(s[13]=e("span",{class:"dark:text-gray-400 text-gray-300"},"Codigo: ",-1)),c(" "+l(t.producto.codigo),1)]),e("p",jt,[s[14]||(s[14]=e("span",{class:"dark:text-gray-400 text-gray-300"},"Detalles: ",-1)),c(l(g(t.precio_unitario))+" x "+l(t.cantidad)+" und",1)]),e("p",St,[s[15]||(s[15]=e("span",{class:"dark:text-gray-400 text-gray-300"},"Subtotal: ",-1)),c(l(g(t.subtotal)),1)])]))),128))]),e("div",Mt,[e("h3",Vt,"Telefono de "+l(a.value.cliente.nombre)+". Ej: 3518019558",1),e("div",Nt,[h(e("input",{"onUpdate:modelValue":s[3]||(s[3]=t=>C.value=t),type:"text",class:"w-full rounded-md border-gray-200"},null,512),[[k,C.value]]),e("button",{class:"w-fit px-6 bg-blue-500 rounded-md text-white",onClick:J},"Actualizar")]),B.value?(r(),n("p",Ut,l(B.value),1)):u("",!0),s[16]||(s[16]=e("h3",{class:"text-md text-gray-500 text-center lg:text-left"},"Vista previa del mensaje:",-1)),h(e("textarea",{"onUpdate:modelValue":s[4]||(s[4]=t=>z.value=t),class:"bg-emerald-500 text-white p-4 rounded-lg w-full h-[300px]"},null,512),[[k,z.value]])])])])])])])]))])])])])])]),_:1},8,["title"]))}},It=P(Bt,[["__scopeId","data-v-5c7edb42"]]);export{It as default};
