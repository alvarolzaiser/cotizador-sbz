import{d as r,p as M,j as P,q as L,c as W,o as s,w as $,a as e,e as a,u as p,F as A,h as F,t as n,g as f,n as Y,f as u,k as i,v as I,s as G,x,y as H,b as J,P as X,z as U}from"./app-DxNCktru.js";import{u as Z,_ as ee}from"./AppLayout-DpCSk7Oo.js";import{l as te}from"./lodash-DUODdzok.js";import{_ as oe}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"py-12"},se={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},ae={class:"bg-white overflow-hidden shadow-xl sm:rounded-lg"},ne={key:0,class:"pt-2 px-6 pb-6"},re={class:"font-bold"},de=["onClick"],ie=["onClick"],ue={class:"w-56"},ce=["onClick"],pe={class:"mt-6"},ve={for:"enviar_cliente",class:"flex flex-row items-center gap-2"},fe={key:0,class:"mt-2 space-y-2"},xe={key:0},me={key:0,class:"bg-blue-500 text-white rounded-sm px-1"},ye={key:1,class:"flex flex-row gap-2 rounded-lg"},be={key:2,class:"text-red-500"},_e={key:3,class:"h-60 overflow-y-scroll rounded-md border border-gray-200"},ge=["for"],we=["value","id"],he={class:"border-r-2 border-blue-500 pr-2"},ke={class:"border-r-none lg:border-r-2 lg:border-blue-500 pr-2"},Ce={class:"hidden lg:block"},Ve={key:1},ze={for:"crear_cliente",class:"flex flex-row items-center gap-2"},Te={key:0,class:"mt-2 space-y-2"},Ee={class:"flex flex-row gap-4"},$e={for:"name",class:"w-full"},Ue={for:"phone",class:"w-full"},je={class:"flex flex-row gap-4"},Se={for:"email",class:"w-full"},Ne={for:"address",class:"w-full"},qe={class:"mt-4"},Be={class:"text-xl font-bold"},Me={key:1,class:"text-gray-500 p-10 flex flex-col justify-center"},Pe={key:0,class:"text-center"},Ae={key:1,class:"flex flex-col gap-2 justify-center"},Fe={class:"text-emerald-500 text-xl"},Ie={class:"text-black"},Re=["href"],De={class:"space-y-2 w-full mt-4"},Oe={class:"text-md text-gray-500 text-center lg:text-left"},Qe={__name:"Cart",setup(Ke){const y=r(M().props.clientes),d=Z(),_=r(!0),b=r(null),R=P(()=>y.value.find(l=>l.id===b.value)),v=r(!1),g=r(null),w=r(null),h=r(null),k=r(null),C=r(""),j=r(null),c=r(null),V=r(""),z=r(""),T=r("");async function E(){try{if(T.value){const l=await U.get(route("clientes.search"),{params:{search:T.value}});y.value=l.data.results}else y.value=M().props.clientes}catch(l){console.log(l)}}const S=te.debounce(async()=>{E()},500),D=async()=>{try{C.value="";const l=await U.post(route("cotizaciones.store"),{carrito:d.items,enviar_cliente:_.value,cliente_seleccionado:b.value,crear_cliente:v.value,nombre:g.value?g.value:"Ejemplo",telefono:w.value?w.value:"3518019558",email:h.value?h.value:"ejemplo@ejemplo.com",direccion:k.value?k.value:"Ejemplo",total:N.value});j.value=l.data.resultado,c.value=l.data.cotizacion,d.items=[],d.syncStorage(),V.value=c.value.cliente.telefono,z.value=await d.msgWPF(c)}catch(l){C.value=l.response.data.error,console.log(l.response.data.error)}};async function O(){const l=await U.get(route("productos.productosActualizados"));d.items.forEach(o=>{const m=o.id,q=o.priceType,Q=o.precio,B=l.data.productos_actualizados.find(K=>K.id===m);Q!==B[q]&&(o.precio=B[q])}),d.syncStorage()}L(async()=>{try{await O()}catch(l){console.error(l)}});const N=P(()=>d.items.reduce((l,t)=>l+t.precio*t.quantity,0));return(l,t)=>(s(),W(ee,{title:"Carrito"},{header:$(()=>t[11]||(t[11]=[e("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Carrito ",-1)])),default:$(()=>[e("div",le,[e("div",se,[e("div",ae,[p(d).items.length>0?(s(),a("div",ne,[(s(!0),a(A,null,F(p(d).items,o=>(s(),a("div",{key:o.id,class:"flex justify-between py-4 border-b"},[e("div",null,[e("p",re,n(o.nombre),1),e("p",null,"Código: "+n(o.codigo),1),e("p",null,[t[12]||(t[12]=f("Cantidad: ")),e("button",{onClick:m=>p(d).updateQuantity(o.id,o.quantity-1),class:"mr-2"},"-",8,de),f(" "+n(o.quantity)+" ",1),e("button",{onClick:m=>p(d).updateQuantity(o.id,o.quantity+1),class:"ml-2"},"+",8,ie)])]),e("div",ue,[e("p",null,"Precio unitario: $"+n(o.precio),1),e("p",null,"Subtotal: $"+n(o.precio*o.quantity),1),e("p",{class:Y(o.priceType=="precio_normal"?"bg-blue-200 px-1 rounded-sm w-fit":o.priceType=="precio_mayorista"?"bg-green-200 px-1 rounded-sm w-fit":"bg-yellow-200 px-1 rounded-sm w-fit")},n(o.priceType=="precio_normal"?"NORMAL":o.priceType=="precio_mayorista"?"MAYORISTA":"EFECTIVO"),3),e("button",{onClick:m=>p(d).removeItem(o.id),class:"text-red-500 mt-2"},"Eliminar",8,ce)])]))),128)),e("div",pe,[e("label",ve,[i(e("input",{type:"checkbox",class:"rounded-full w-5 h-5","onUpdate:modelValue":t[0]||(t[0]=o=>_.value=o),id:"enviar_cliente"},null,512),[[I,_.value]]),t[13]||(t[13]=e("span",{class:"text-xl"},"Enviar cliente",-1))]),_.value?(s(),a("div",fe,[v.value?u("",!0):(s(),a("h3",xe,[t[14]||(t[14]=f("Seleccionar cliente: ")),b.value?(s(),a("span",me,n(R.value.nombre),1)):u("",!0)])),v.value?u("",!0):(s(),a("div",ye,[i(e("input",{onKeyup:[t[1]||(t[1]=(...o)=>p(S)&&p(S)(...o)),G(E,["enter"])],type:"text","onUpdate:modelValue":t[2]||(t[2]=o=>T.value=o),class:"w-full rounded-md border-gray-200",placeholder:"Buscar cliente..."},null,544),[[x,T.value]]),e("button",{onClick:E,class:"w-fit px-6 bg-blue-500 rounded-md text-white hidden lg:block"},"Buscar")])),C.value?(s(),a("div",be,n(C.value),1)):u("",!0),v.value?u("",!0):(s(),a("div",_e,[y.value.length>0?(s(!0),a(A,{key:0},F(y.value,o=>(s(),a("div",{key:o.id},[e("label",{for:`radio_${o.id}`,class:"w-fit p-2 flex flex-row gap-2 items-center border-b-red-500"},[i(e("input",{type:"radio",value:o.id,"onUpdate:modelValue":t[3]||(t[3]=m=>b.value=m),class:"rounded-full",id:`radio_${o.id}`},null,8,we),[[H,b.value]]),e("h3",he,n(o.nombre),1),e("h3",ke,n(o.telefono),1),e("h3",Ce,n(o.email),1)],8,ge)]))),128)):(s(),a("div",Ve,t[15]||(t[15]=[e("h3",{class:"text-red-500 text-center p-4"},"No hay clientes para mostrar",-1)])))])),e("div",null,[e("label",ze,[i(e("input",{type:"checkbox",class:"rounded-full w-5 h-5","onUpdate:modelValue":t[4]||(t[4]=o=>v.value=o),id:"crear_cliente"},null,512),[[I,v.value]]),t[16]||(t[16]=e("span",{class:"text-xl"},"Crear cliente",-1))]),v.value?(s(),a("div",Te,[e("div",Ee,[e("label",$e,[t[17]||(t[17]=f(" Nombre ")),i(e("input",{class:"w-full rounded-md border-gray-200",type:"text",id:"name","onUpdate:modelValue":t[5]||(t[5]=o=>g.value=o)},null,512),[[x,g.value]])]),e("label",Ue,[t[18]||(t[18]=f(" Telefono ")),i(e("input",{class:"w-full rounded-md border-gray-200",type:"text",id:"phone","onUpdate:modelValue":t[6]||(t[6]=o=>w.value=o)},null,512),[[x,w.value]])])]),e("div",je,[e("label",Se,[t[19]||(t[19]=f(" Email ")),i(e("input",{class:"w-full rounded-md border-gray-200",type:"text",id:"email","onUpdate:modelValue":t[7]||(t[7]=o=>h.value=o)},null,512),[[x,h.value]])]),e("label",Ne,[t[20]||(t[20]=f(" Direccion ")),i(e("input",{class:"w-full rounded-md border-gray-200",type:"text",id:"address","onUpdate:modelValue":t[8]||(t[8]=o=>k.value=o)},null,512),[[x,k.value]])])])])):u("",!0)])])):u("",!0)]),e("div",qe,[e("p",Be,"Total: $"+n(N.value),1),e("button",{onClick:D,class:"bg-green-500 text-white px-4 py-2 rounded mt-4"}," Finalizar Cotización ")])])):(s(),a("div",Me,[c.value?u("",!0):(s(),a("p",Pe,"El carrito está vacío.")),c.value?(s(),a("div",Ae,[e("h3",Fe,n(j.value),1),e("p",Ie,"Total: $"+n(c.value.total),1),J(p(X),{href:l.route("cotizaciones.show",c.value.id)},{default:$(()=>t[21]||(t[21]=[e("button",{class:"bg-blue-500 text-white py-2 px-4 rounded-md w-full lg:w-60"},"Ver cotizacion",-1)])),_:1},8,["href"]),e("a",{href:`https://api.whatsapp.com/send?phone=549${V.value}&text=${encodeURIComponent(z.value)}`,target:"_blank"},t[22]||(t[22]=[e("button",{class:"bg-emerald-500 text-white py-2 px-4 rounded-md w-full lg:w-60"}," Enviar cotizacion ",-1)]),8,Re),e("div",De,[e("h3",Oe,"Telefono de "+n(c.value.cliente.nombre)+". Ej: 3518019558",1),i(e("input",{"onUpdate:modelValue":t[9]||(t[9]=o=>V.value=o),type:"text",class:"w-full rounded-md border-gray-200"},null,512),[[x,V.value]]),t[23]||(t[23]=e("h3",{class:"text-md text-gray-500 text-center lg:text-left"},"Vista previa del mensaje:",-1)),i(e("textarea",{"onUpdate:modelValue":t[10]||(t[10]=o=>z.value=o),class:"bg-emerald-500 text-white p-4 rounded-lg w-full h-[300px]"},null,512),[[x,z.value]])])])):u("",!0)]))])])])]),_:1}))}},He=oe(Qe,[["__scopeId","data-v-87cee93c"]]);export{He as default};
